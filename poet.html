<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026·新岁诗意</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* --- 全局与字体 --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap'); /* 引入书法字体用于标题 */

        :root {
            --palace-red: #8B0000;   /* 深沉的宫墙红 */
            --imperial-gold: #D4AF37; /* 更有质感的鎏金 */
            --snow-white: #F8F9FA;
            --ink-black: #1A1A1A;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Serif SC', 'Songti SC', serif;
            overflow: hidden;
            background-color: #2c0e0e; /* 图片未加载时的深色底 */
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--snow-white);
        }

        /* --- 背景层 (全屏轮播) --- */
        #bg-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -3;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 4s ease-in-out; /* 4秒极柔和切换 */
        }

        /* 电影感暗角遮罩：让视线聚焦中心，同时保证文字清晰 */
        #vignette-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -2;
            background: radial-gradient(circle at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.4) 60%, rgba(0,0,0,0.7) 100%);
            pointer-events: none;
        }

        #snow-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        /* --- 主容器 --- */
        .container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* --- 场景通用样式 --- */
        .scene {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 1.2s cubic-bezier(0.22, 1, 0.36, 1), transform 1.2s cubic-bezier(0.22, 1, 0.36, 1);
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95) translateY(20px);
        }

        .scene.active {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1) translateY(0);
        }

        /* --- 场景1：开场 --- */
        .main-title {
            font-family: 'Ma Shan Zheng', cursive; /* 书法字体 */
            font-size: 5rem;
            color: var(--snow-white);
            margin-bottom: 1rem;
            text-shadow: 0 4px 15px rgba(0,0,0,0.6);
            letter-spacing: 0.1em;
            opacity: 0.95;
        }

        .sub-title {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 300;
            margin-bottom: 4rem;
            letter-spacing: 0.6em;
            border-top: 1px solid rgba(255, 255, 255, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
            padding: 12px 0;
            text-shadow: 0 2px 8px rgba(0,0,0,0.6);
        }

        .btn-start {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.6);
            color: var(--snow-white);
            padding: 18px 60px;
            font-size: 1.2rem;
            font-family: 'Noto Serif SC', serif;
            cursor: pointer;
            transition: all 0.5s ease;
            border-radius: 50px;
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            letter-spacing: 0.2em;
        }

        .btn-start:hover {
            background: rgba(212, 175, 55, 0.9); /* 鎏金背景 */
            border-color: var(--imperial-gold);
            color: #2c0e0e;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.6);
            transform: translateY(-2px);
        }

        /* --- 场景2：抽取界面 --- */
        .draw-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .draw-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.1);
        }

        .draw-circle:hover {
            transform: scale(1.08);
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--imperial-gold);
            box-shadow: 0 0 60px rgba(212, 175, 55, 0.4);
        }

        /* 呼吸光环 */
        .ring {
            position: absolute;
            top: -15px; left: -15px; right: -15px; bottom: -15px;
            border: 1px dashed rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: spin 20s linear infinite;
        }

        .draw-text {
            color: var(--snow-white);
            font-size: 1.8rem;
            letter-spacing: 0.4em;
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-family: 'Ma Shan Zheng', cursive;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .draw-hint {
            margin-top: 50px;
            font-size: 1.1rem;
            letter-spacing: 0.2em;
            opacity: 0.8;
            font-weight: 300;
        }

        .loading-text {
            display: none;
            color: var(--imperial-gold);
            font-size: 1.3rem;
            margin-top: 30px;
            letter-spacing: 0.2em;
            animation: pulse 1.5s infinite ease-in-out;
        }

        /* --- 场景3：结果卡片 (重点优化) --- */
        .poetry-card {
            width: 440px;
            padding: 60px 45px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            
            /* 玻璃拟态核心 */
            background: rgba(255, 252, 245, 0.85); /* 暖白，降低不透明度 */
            backdrop-filter: blur(12px); /* 强模糊，保证背景图可见但字清晰 */
            -webkit-backdrop-filter: blur(12px);
            
            /* 光影质感 */
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4), /* 深邃阴影 */
                inset 0 0 0 1px rgba(255, 255, 255, 0.8); /* 内部高光描边 */
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        /* 卡片内文字颜色优化，确保对比度 */
        .card-year {
            font-size: 0.9rem;
            color: #8B0000; /* 深红 */
            font-weight: 700;
            letter-spacing: 0.3em;
            margin-bottom: 35px;
            opacity: 0.8;
        }

        .poem-text {
            font-size: 1.8rem;
            line-height: 1.5;
            color: #1a1a1a; /* 近乎全黑，保证清晰 */
            margin-bottom: 25px;
            font-weight: 700;
            font-family: 'Songti SC', serif;
            text-shadow: 0 1px 1px rgba(255,255,255,0.8); /* 文字凸起感 */
        }

        .poem-source {
            font-size: 1rem;
            color: #555;
            margin-bottom: 35px;
            font-style: italic;
        }

        .divider {
            width: 30px;
            height: 3px;
            background: linear-gradient(to right, transparent, #8B0000, transparent);
            margin: 0 auto 35px auto;
            opacity: 0.6;
        }

        .poem-desc {
            font-size: 1.05rem;
            line-height: 1.9;
            color: #333;
            text-align: justify;
            text-align-last: center;
            font-weight: 400;
        }

        /* 装饰角标 */
        .corner {
            position: absolute;
            width: 25px;
            height: 25px;
            border: 2px solid var(--imperial-gold);
            opacity: 0.8;
            transition: all 0.5s;
        }
        .tl { top: 15px; left: 15px; border-right: none; border-bottom: none; }
        .tr { top: 15px; right: 15px; border-left: none; border-bottom: none; }
        .bl { bottom: 15px; left: 15px; border-right: none; border-top: none; }
        .br { bottom: 15px; right: 15px; border-left: none; border-top: none; }

        .stamp {
            margin-top: 40px;
            width: 36px;
            height: 36px;
            background: #8B0000;
            color: #fff;
            font-size: 16px;
            line-height: 36px;
            border-radius: 4px;
            display: inline-block;
            box-shadow: 0 2px 6px rgba(139, 0, 0, 0.4);
            font-family: 'Ma Shan Zheng', cursive;
        }

        .actions {
            margin-top: 40px;
            display: flex;
            gap: 20px;
        }

        .btn-action {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.4);
            color: #fff;
            padding: 12px 30px;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.3s;
            backdrop-filter: blur(4px);
            font-size: 0.95rem;
        }

        .btn-action:hover {
            background: var(--imperial-gold);
            border-color: var(--imperial-gold);
            color: #2c0e0e;
        }

        /* 动画 */
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        /* 移动端适配 */
        @media (max-width: 600px) {
            .main-title { font-size: 3.5rem; }
            .poetry-card { width: 90%; padding: 40px 25px; }
            .poem-text { font-size: 1.5rem; }
            .draw-circle { width: 160px; height: 160px; }
        }
    </style>
</head>
<body>

    <div id="bg-container"></div>
    <div id="vignette-overlay"></div>
    <canvas id="snow-canvas"></canvas>

    <div class="container">
        
        <div class="scene active" id="scene-intro">
            <div class="main-title">二零二六</div>
            <div class="sub-title">用诗意开启你的开场白</div>
            <br>
            <button class="btn-start" onclick="goToDraw()">开启新岁</button>
        </div>

        <div class="scene" id="scene-draw">
            <div class="draw-container">
                <div class="draw-circle" id="drawBtn" onclick="performDraw()">
                    <div class="ring"></div>
                    <div class="draw-text">开启签文</div>
                </div>
                <div class="draw-hint" id="drawHint">点击抽取你的新年寄语</div>
                <div class="loading-text" id="loadingText">瑞雪兆丰年，正在寻觅...</div>
            </div>
        </div>

        <div class="scene" id="scene-result">
            <div class="poetry-card" id="captureTarget">
                <div class="corner tl"></div><div class="corner tr"></div>
                <div class="corner bl"></div><div class="corner br"></div>
                
                <div class="card-year">2026 NEW YEAR</div>
                
                <div class="poem-text" id="pText"></div>
                <div class="poem-source" id="pSource"></div>
                
                <div class="divider"></div>
                
                <div class="poem-desc" id="pDesc"></div>
                
                <div class="stamp">福</div>
            </div>

            <div class="actions">
                <button class="btn-action" onclick="downloadCard()">保存卡片</button>
                <button class="btn-action" onclick="resetToDraw()">再抽一次</button>
            </div>
        </div>

    </div>

    <script>
        // --- 1. 背景配置 (GitHub Raw) ---
        const bgImages = [
            'https://raw.githubusercontent.com/clorisxuan8-sys/1/main/images/故宫.jpg',
            'https://raw.githubusercontent.com/clorisxuan8-sys/1/main/images/故宫2.jpg',
            'https://raw.githubusercontent.com/clorisxuan8-sys/1/main/images/故宫3.jpg'
        ];

        // --- 2. 诗词数据 ---
        //
        const poems = [
            {
                text: "老去又逢新岁月<br>春来更有好花枝",
                source: "明·陈献章《元旦试笔》",
                desc: "生命本就是流动的。不要惧怕时间的流逝，它不仅带来年龄，更带来了新的岁月与可能。请自信、坚定地迎接更美好的未来。"
            },
            {
                text: "但得老亲常健好<br>不辞新岁且穷忙",
                source: "宋·吕本中《得扬州书》",
                desc: "只要父母长辈身体安康，即使新的一年忙碌奔波也心甘情愿。家是温暖的港湾，父母在，人生便有归处。"
            },
            {
                text: "韶华长在，明年依旧<br>相与笑春风",
                source: "宋·张先《少年游》",
                desc: "岁月流转，花儿依然准时开放。这是一种永恒的约定：时光不老，我们不散。愿往后每一年，都能在春风中把酒言欢。"
            },
            {
                text: "一年忧喜今宵过<br>两鬓风霜明日新",
                source: "明·谢榛《除夕吴子充诸人集旅寓有感》",
                desc: "学会“翻篇”的能力。旧年的忧喜今晚便成过往，明日又是崭新的一天。无论情绪仍在与否，我们要有能力过好当下的日子。"
            },
            {
                text: "更祝明朝风日好<br>梅花满眼踏新年",
                source: "明·吴与弼《除夜次唐诗韵》",
                desc: "衷心祝愿明天风和日丽，满眼皆是盛开的梅花。让我们怀着洒然自得的心情，踏着这美好的景致，迈入新的一年。"
            },
            {
                text: "历添新岁月<br>春满旧山河",
                source: "宋·叶梦得",
                desc: "山河熟悉安稳，却因春意而焕然一新。人生不是推倒重来，而是在既有的努力与沉淀之上，继续向前，迎来万物复苏。"
            },
            {
                text: "但愿年年<br>春风有信，人心长久",
                source: "宋·蔡伸《柳梢青》",
                desc: "不求惊天动地，只愿岁月缓慢向前，所盼皆有回应。愿春风如约而至，愿人与人之间多一份笃定与陪伴，长久而安。"
            },
            {
                text: "岁岁年年，共欢同乐<br>嘉庆于时新",
                source: "宋·晏殊《少年游》",
                desc: "真正的喜悦是有人同行、有人分享。愿好运就在当下悄然发生，愿每一个当下都值得庆贺，岁岁安然。"
            },
            {
                text: "愿得长如此<br>年年物候新",
                source: "唐·卢照邻《元日述怀》",
                desc: "这是一种克制而深情的祈愿。不求瞬间的惊艳，只愿当下的安稳与从容能够延续。时光向前，万物常新，日日皆有风景。"
            },
            {
                text: "休将旧事从头说<br>且喜新年入手来",
                source: "宋词人",
                desc: "真正的成熟是承认过去、然后放下。新年已如礼物般握在掌中，愿你轻装前行，把热情与勇气留给正在到来的时光。"
            }
        ];

        // --- 3. 场景逻辑 ---
        function switchScene(fromId, toId) {
            const fromScene = document.getElementById(fromId);
            const toScene = document.getElementById(toId);
            
            fromScene.classList.remove('active');
            // 稍作延迟，让淡出更自然
            setTimeout(() => {
                toScene.classList.add('active');
            }, 800);
        }

        function goToDraw() {
            switchScene('scene-intro', 'scene-draw');
        }

        let isDrawing = false;
        function performDraw() {
            if (isDrawing) return;
            isDrawing = true;

            const drawBtn = document.getElementById('drawBtn');
            const hint = document.getElementById('drawHint');
            const loading = document.getElementById('loadingText');

            drawBtn.style.transform = 'scale(0.9) rotate(180deg)';
            drawBtn.style.opacity = '0.6';
            hint.style.opacity = '0';
            loading.style.display = 'block';

            // 延长到2秒，让用户多感受一会儿雪景
            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * poems.length);
                const data = poems[randomIndex];
                
                document.getElementById('pText').innerHTML = data.text;
                document.getElementById('pSource').innerText = data.source;
                document.getElementById('pDesc').innerText = data.desc;

                switchScene('scene-draw', 'scene-result');
                
                setTimeout(() => {
                    isDrawing = false;
                    drawBtn.style.transform = 'scale(1) rotate(0deg)';
                    drawBtn.style.opacity = '1';
                    hint.style.opacity = '0.8';
                    loading.style.display = 'none';
                }, 1000);
            }, 2000);
        }

        function resetToDraw() {
            switchScene('scene-result', 'scene-draw');
        }

        function downloadCard() {
            const element = document.getElementById('captureTarget');
            // 暂时移除磨砂和透明效果以保证导出的图片背景不黑
            const originalBackground = element.style.background;
            const originalTransform = element.style.transform;
            
            // 导出时稍微调白一点背景，防止字看不清，同时保持圆角
            element.style.background = "rgba(255, 252, 245, 0.95)";
            element.style.transform = "none";
            element.style.boxShadow = "none"; // 移除阴影防止导出边缘黑晕

            html2canvas(element, {
                backgroundColor: null, // 透明背景，这样圆角外是透明的
                scale: 3, // 超高清
                useCORS: true 
            }).then(canvas => {
                // 恢复样式
                element.style.background = originalBackground;
                element.style.transform = originalTransform;
                element.style.boxShadow = ""; 

                const link = document.createElement('a');
                link.download = '2026新年签.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // --- 4. 背景轮播逻辑 (已优化) ---
        let currentBgIndex = 0;
        const bgContainer = document.getElementById('bg-container');

        function initBackground() {
            const img = new Image();
            img.onload = () => {
                 bgContainer.style.backgroundImage = `url('${bgImages[0]}')`;
                 // 开启平滑轮播
                 setInterval(() => {
                    currentBgIndex = (currentBgIndex + 1) % bgImages.length;
                    bgContainer.style.backgroundImage = `url('${bgImages[currentBgIndex]}')`;
                }, 7000); // 7秒切换，配合CSS的4秒过渡，极其丝滑
            };
            img.src = bgImages[0];
        }

        // --- 5. 慢速雪效 (Snow Logic Optimized) ---
        function initSnow() {
            const canvas = document.getElementById('snow-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            // 增加粒子数量，但减慢速度
            const particleCount = 2000;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const velocities = new Float32Array(particleCount);
            const drift = new Float32Array(particleCount); // 增加水平飘动参数

            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 25;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 25;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 25;
                // 极慢的下落速度：0.002 ~ 0.006
                velocities[i] = 0.002 + Math.random() * 0.004; 
                drift[i] = (Math.random() - 0.5) * 0.005; // 随机左右飘
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            // 更柔和的雪花纹理
            function getSprite() {
                const canvas = document.createElement('canvas');
                canvas.width = 32; canvas.height = 32;
                const context = canvas.getContext('2d');
                const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
                gradient.addColorStop(0, 'rgba(255,255,255,0.9)');
                gradient.addColorStop(0.4, 'rgba(255,255,255,0.4)');
                gradient.addColorStop(1, 'rgba(0,0,0,0)');
                context.fillStyle = gradient;
                context.fillRect(0, 0, 32, 32);
                return new THREE.CanvasTexture(canvas);
            }

            const material = new THREE.PointsMaterial({
                size: 0.12, 
                map: getSprite(), 
                transparent: true, 
                opacity: 0.8,
                depthWrite: false, 
                blending: THREE.AdditiveBlending
            });

            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                const positions = particles.geometry.attributes.position.array;
                
                for (let i = 0; i < particleCount; i++) {
                    // 下落
                    positions[i * 3 + 1] -= velocities[i];
                    
                    // 左右飘动 (Sine wave + random drift)
                    positions[i * 3] += Math.sin(Date.now() * 0.0005 + positions[i * 3 + 1]) * 0.002 + drift[i];

                    // 循环逻辑
                    if (positions[i * 3 + 1] < -12) {
                        positions[i * 3 + 1] = 12;
                        positions[i * 3] = (Math.random() - 0.5) * 25;
                    }
                }
                
                particles.geometry.attributes.position.needsUpdate = true;
                
                // 整个场景缓慢旋转，模拟视线移动
                particles.rotation.y += 0.0002;
                particles.rotation.x += 0.0001;

                renderer.render(scene, camera);
            }

            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        window.onload = () => {
            initBackground();
            initSnow();
        };
    </script>
</body>
</html>
